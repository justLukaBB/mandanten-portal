<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Mandanten-Portal - Interaktives Flussdiagramm</title>
    <script src="https://cdn.jsdelivr.net/npm/mermaid@10/dist/mermaid.min.js"></script>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
            margin: 0;
            padding: 0;
            background-color: #f5f5f5;
        }
        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
        }
        h1, h2 {
            color: #333;
            text-align: center;
        }
        .flowchart-section {
            background: white;
            border-radius: 8px;
            padding: 20px;
            margin-bottom: 30px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        .mermaid {
            text-align: center;
            margin: 20px 0;
        }
        .description {
            color: #666;
            margin-bottom: 20px;
            line-height: 1.6;
        }
        .legend {
            display: flex;
            justify-content: center;
            gap: 20px;
            margin: 20px 0;
            flex-wrap: wrap;
        }
        .legend-item {
            display: flex;
            align-items: center;
            gap: 8px;
        }
        .legend-box {
            width: 20px;
            height: 20px;
            border-radius: 4px;
        }
        .nav-tabs {
            display: flex;
            gap: 10px;
            margin-bottom: 30px;
            flex-wrap: wrap;
            justify-content: center;
        }
        .nav-tab {
            padding: 10px 20px;
            background: #9f1a1d;
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            transition: background 0.3s;
        }
        .nav-tab:hover {
            background: #7a1417;
        }
        .nav-tab.active {
            background: #5a0e10;
        }
        .section {
            display: none;
        }
        .section.active {
            display: block;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>🏢 Mandanten-Portal System Flussdiagramm</h1>
        <p style="text-align: center; color: #666;">Interaktive Visualisierung des Insolvenz-Verwaltungssystems</p>
        
        <div class="nav-tabs">
            <button class="nav-tab active" onclick="showSection('main')">Hauptablauf</button>
            <button class="nav-tab" onclick="showSection('document')">Dokumentenverarbeitung</button>
            <button class="nav-tab" onclick="showSection('settlement')">Bereinigungsplan-Berechnung</button>
            <button class="nav-tab" onclick="showSection('status')">Status-Workflow</button>
            <button class="nav-tab" onclick="showSection('architecture')">Architektur</button>
            <button class="nav-tab" onclick="showSection('admin')">Admin-Aktionen</button>
            <button class="nav-tab" onclick="showSection('calculations')">Dokumenten-Berechnungen</button>
            <button class="nav-tab" onclick="showSection('financial')">Finanzdaten & Plantypen</button>
        </div>

        <!-- Main Flow Section -->
        <div id="main" class="section active">
            <div class="flowchart-section">
                <h2>📋 Hauptsystem-Ablauf</h2>
                <p class="description">
                    Dieses Flussdiagramm zeigt den kompletten Lebenszyklus eines Mandantenfalls von der Erstellung bis zum Abschluss,
                    einschließlich Dokumentenupload, Zahlungsverarbeitung und Gläubiger-Management.
                </p>
                <div class="mermaid">
                    graph TB
                        Start([Mandanten Insolvenzfall]) --> Create[Berater erstellt Mandanten]
                        Create --> Portal[Portal-Zugang generieren]
                        Portal --> SendLoginEmail[Login-E-Mail versenden]
                        
                        SendLoginEmail --> LoginCheck{Mandant loggt sich ein?}
                        LoginCheck -->|Nein - 7 Tage| LoginReminder{Login-Erinnerung gesendet?}
                        LoginReminder -->|Nein| SendLoginReminder[📧 Login-Erinnerung senden]
                        LoginReminder -->|Ja| WaitLogin[Weiter warten]
                        SendLoginReminder --> WaitLogin
                        WaitLogin --> LoginCheck
                        
                        LoginCheck -->|Ja| UploadCheck{Lädt Dokumente hoch?}
                        UploadCheck -->|Nein| LoginTimer[7-Tage Timer starten]
                        LoginTimer --> DocReminderCheck{7 Tage seit Login?}
                        DocReminderCheck -->|Nein| WaitForUpload[Auf Upload warten]
                        WaitForUpload --> UploadCheck
                        DocReminderCheck -->|Ja| DocReminderSent{Dok-Erinnerung gesendet?}
                        DocReminderSent -->|Nein| SendDocReminder[📧 Dokumenten-Upload Erinnerung]
                        DocReminderSent -->|Ja| WaitForUpload
                        SendDocReminder --> WaitForUpload
                        
                        UploadCheck -->|Ja| AIProcess[🔍 Google OCR + KI-Verarbeitung<br/>3s pro Dokument]
                        AIProcess --> TextDetected{Text erkannt?}
                        TextDetected -->|Nein| NoTextLabel[📄 Label: 'Kein Text'<br/>Verarbeitung beenden]
                        TextDetected -->|Ja| ExtractCreditors[🤖 KI Gläubiger extrahieren]
                        
                        ExtractCreditors --> ConfidenceCheck{KI-Konfidenz?}
                        ConfidenceCheck -->|≥ 80%| AIAnalyzedLabel[✅ Label: 'KI Analysiert']
                        ConfidenceCheck -->|< 80%| ManualReviewLabel[⚠️ Label: 'Manuelle Prüfung']
                        
                        AIAnalyzedLabel --> AllDocsLabeled{Alle Dokumente<br/>gelabelt?}
                        ManualReviewLabel --> AllDocsLabeled
                        NoTextLabel --> AllDocsLabeled
                        
                        AllDocsLabeled -->|Nein| NextDoc[Nächstes Dokument verarbeiten]
                        NextDoc --> AIProcess
                        AllDocsLabeled -->|Ja| PaymentCheck{Erste Zahlung erfolgt?}
                        PaymentCheck -->|Keine Zahlung| WaitPayment[Auf Zahlung warten<br/>Noch keine Berater-Prüfung]
                        PaymentCheck -->|Zahlung + Hat Docs| ReviewNeeded{Manuelle Prüfung<br/>Dokumente?}
                        PaymentCheck -->|Zahlung + Keine Docs| StartPaymentReminders[📧 Dokumenten<br/>Upload-Erinnerungen<br/>Alle 2 Tage]
                        
                        WaitPayment --> PaymentConfirm[Zahlung bestätigt]
                        PaymentConfirm --> BackToReviewCheck[Prüfen ob Dokumente<br/>Prüfung benötigen]
                        BackToReviewCheck --> ReviewNeeded
                        
                        ReviewNeeded -->|Ja| AgentReview[👨‍💼 Berater prüft NUR<br/>Manuelle Prüfung Dokumente<br/>Ignoriert Kein-Text Docs]
                        ReviewNeeded -->|Nein Alle KI Analysiert| ScheduleDelay[24h Verzögerung planen]
                        AgentReview --> ScheduleDelay
                        StartPaymentReminders --> PaymentReminderLoop{Erinnerung fällig?}
                        PaymentReminderLoop -->|Ja, 2+ Tage| PaymentReminderSent{Letzte Erinnerung gesendet?}
                        PaymentReminderSent -->|>2 Tage her| SendPaymentReminder[📧 Eskalierte<br/>Dokumenten-Erinnerung]
                        PaymentReminderSent -->|<2 Tage her| WaitPaymentReminder[2 Tage warten]
                        PaymentReminderLoop -->|Nein| WaitPaymentReminder
                        SendPaymentReminder --> WaitPaymentReminder
                        WaitPaymentReminder --> CheckUpload{Dokumente hochgeladen?}
                        CheckUpload -->|Nein| PaymentReminderLoop
                        CheckUpload -->|Ja| BackToAI[Zurück zur KI-Verarbeitung]
                        BackToAI --> AIProcess
                        ScheduleDelay --> DelayCheck{24 Stunden vergangen?}
                        DelayCheck -->|Nein| DelayCheck
                        DelayCheck -->|Ja| CreateTicket[Zendesk-Ticket erstellen]
                        
                        CreateTicket --> ReviewType{Pruefungstyp?}
                        ReviewType -->|Auto Genehmigt| ClientConfirmation[Mandanten-Bestaetigung]
                        ReviewType -->|Manuelle Pruefung| AgentReview2[Berater-Pruefung]
                        ReviewType -->|Keine Glaeubiger| ManualCheck[Manuelle Pruefung]
                        
                        AgentReview2 --> ApproveCreditors[Glaeubiger genehmigen]
                        ManualCheck --> ApproveCreditors
                        ApproveCreditors --> ClientConfirmation
                        
                        ClientConfirmation --> ClientConfirmed{Mandant bestaetigt?}
                        ClientConfirmed -->|Ja| ContactCreditors[ALLE Glaeubiger kontaktieren<br/>E-Mail Vorlage: Schuldenverifikation<br/>Zweck: Aktuelle Schuldenhoehe<br/>fuer Bereinigungsplanung verifizieren]
                        ClientConfirmed -->|Nein| FollowUpClient[Nachfassen]
                        FollowUpClient --> ClientConfirmation
                        
                        ContactCreditors --> Start30DayTimer[30-Tage Antwort-Timer starten]
                        Start30DayTimer --> TrackResponses[Glaeubigerantworten verfolgen<br/>Antwort-Datum<br/>Aktualisierte Schuldenhoehe<br/>Kontakt-Status<br/>Antwort-E-Mail Inhalt]
                        
                        TrackResponses --> Check30Days{30 Tage<br/>vergangen?}
                        Check30Days -->|Nein| TrackResponses
                        Check30Days -->|Ja| AnalyzeResponses[Antwort-Ergebnisse analysieren<br/>Wer antwortete vs. Keine Antwort]
                        
                        AnalyzeResponses --> CreateAmountTable[Finale Betrags-Tabelle erstellen<br/>Geantwortet: Neuen Betrag nutzen<br/>Keine Antwort: Original-Betrag<br/>Kein Original: Standard 100 Euro]
                        
                        CreateAmountTable --> ShowFinancialForm[Finanzdaten-Formular anzeigen<br/>im Mandanten-Portal<br/>Nettoeinkommen in Euro<br/>Anzahl Kinder<br/>Familienstand]
                        
                        ShowFinancialForm --> ClientFillsForm{Mandant fuellt<br/>Formular aus?}
                        ClientFillsForm -->|Nein| WaitForFinancialData[Warten auf Finanzdaten]
                        WaitForFinancialData --> ClientFillsForm
                        
                        ClientFillsForm -->|Ja| SaveFinancialData[Finanzdaten speichern<br/>in Client.financial_data]
                        SaveFinancialData --> CalculateGarnishment[Pfaendbaren Betrag berechnen<br/>Deutsche Pfaendungstabelle 2024<br/>Basierend auf Einkommen + Familie]
                        
                        CalculateGarnishment --> RecommendPlanType[Plan-Typ empfehlen<br/>Automatische Logik]
                        RecommendPlanType --> CreateAgentTicket[Zendesk-Ticket erstellen<br/>fuer Agent Review Dashboard<br/>Plantyp-Bestaetigung erforderlich]
                        
                        CreateAgentTicket --> AgentSelectsPlan{Agent waehlt Plan-Typ}
                        AgentSelectsPlan -->|Quotenplan| QuotaPlan[Quotenplan<br/>Monatliche Raten<br/>z.B. 750 Euro/Monat oder 880 Euro/Monat]
                        AgentSelectsPlan -->|Nullplan| ZeroPlan[Nullplan<br/>Flexible Zahlungen<br/>nur bei verfuegbarem Einkommen]
                        
                        QuotaPlan --> GenerateTwoDocs[Zwei Dokumente generieren]
                        ZeroPlan --> GenerateTwoDocs
                        
                        GenerateTwoDocs --> SelectedPlan[1. Gewaehlter Bereinigungsplan<br/>Word-Dokument basierend auf Plantyp<br/>Quotenplan ODER Nullplan]
                        GenerateTwoDocs --> CreditorList[2. Glaeubigerliste<br/>Vollstaendige Glaeubigerliste<br/>Kontaktinformationen<br/>Finale Betraege]
                        
                        SelectedPlan --> SendSecondEmail[Zweite E-Mail-Runde<br/>an ALLE Glaeubiger<br/>via Zendesk Side Conversations<br/>Plan-Genehmigung anfragen]
                        CreditorList --> SendSecondEmail
                        
                        SendSecondEmail --> TrackPlanApproval[Plan-Genehmigungen verfolgen<br/>30-Tage-Timer fuer Antworten]
                        TrackPlanApproval --> Complete([Abgeschlossen])
                        
                        style Start fill:#e1f5e1
                        style Complete fill:#e1f5e1
                        style AIProcess fill:#fff3cd
                        style CreateTicket fill:#cfe2ff
                        style SendLoginReminder fill:#ffe4e1
                        style SendDocReminder fill:#ffe4e1
                        style SendPaymentReminder fill:#ffe4e1
                        style StartPaymentReminders fill:#fff2cc
                        style AIAnalyzedLabel fill:#d1e7dd
                        style ManualReviewLabel fill:#f8d7da
                        style NoTextLabel fill:#ffecb3
                        style ContactCreditors fill:#e8f5e9
                        style TrackResponses fill:#fff3e0
                        style AnalyzeResponses fill:#f3e5f5
                        style CreateAmountTable fill:#e0f2f1
                </div>
                <div class="legend">
                    <div class="legend-item">
                        <div class="legend-box" style="background: #e1f5e1;"></div>
                        <span>Start/Ende</span>
                    </div>
                    <div class="legend-item">
                        <div class="legend-box" style="background: #fff3cd;"></div>
                        <span>KI-Verarbeitung</span>
                    </div>
                    <div class="legend-item">
                        <div class="legend-box" style="background: #cfe2ff;"></div>
                        <span>Zendesk-Integration</span>
                    </div>
                    <div class="legend-item">
                        <div class="legend-box" style="background: #ffe4e1;"></div>
                        <span>E-Mail Erinnerungen</span>
                    </div>
                    <div class="legend-item">
                        <div class="legend-box" style="background: #fff2cc;"></div>
                        <span>Erinnerungssystem</span>
                    </div>
                </div>
            </div>
        </div>

        <!-- Document Processing Section -->
        <div id="document" class="section">
            <div class="flowchart-section">
                <h2>📄 Erweiterte Dokumentenverarbeitung</h2>
                <p class="description">
                    Detaillierte Ansicht wie Dokumente mit Google OCR und KI-Analyse verarbeitet werden
                    mit Konfidenz-Bewertung, Texterkennung und der 80%-Schwellenwert-Regel.
                </p>
                <div class="mermaid">
                    graph TB
                        Upload([Dokument Upload]) --> Validate{Gültiger Dateityp?}
                        Validate -->|Ungültig| ShowError[❌ Dateityp-Fehler anzeigen]
                        Validate -->|Gültig| Store[💾 In /uploads speichern]
                        
                        Store --> Queue[📋 Zur Verarbeitungsqueue hinzufügen]
                        Queue --> Delay[⏱️ 3 Sekunden Verzögerung pro Dokument]
                        Delay --> OCR[🔍 Google OCR Verarbeitung]
                        
                        OCR --> TextCheck{Text erkannt?}
                        TextCheck -->|Kein Text| NoTextEnd[📄 Als 'Kein Text' markieren<br/>Verarbeitung beenden]
                        TextCheck -->|Text gefunden| AIAnalysis[🤖 KI-Analyse<br/>Claude/OpenAI]
                        
                        AIAnalysis --> DocumentType{Dokumentenklassifizierung}
                        DocumentType -->|Gläubiger-Dokument| ExtractData[📊 Gläubiger-Daten extrahieren:<br/>• Firmenname<br/>• Schuldsumme<br/>• Adresse<br/>• Referenznummer]
                        DocumentType -->|Kein Gläubiger| MarkNonCreditor[📝 Label: Kein Gläubiger]
                        
                        ExtractData --> ConfidenceCheck{Konfidenz-Score?}
                        ConfidenceCheck -->|≥ 80%| LabelAIAnalyzed[✅ Label: 'KI Analysiert'<br/>Hohe Konfidenz]
                        ConfidenceCheck -->|< 80%| LabelManualReview[⚠️ Label: 'Manuelle Prüfung'<br/>Niedrige Konfidenz]
                        
                        LabelAIAnalyzed --> SaveToDB[(💾 In MongoDB speichern)]
                        LabelManualReview --> SaveToDB
                        MarkNonCreditor --> SaveToDB
                        NoTextEnd --> SaveToDB
                        
                        SaveToDB --> CheckAllDocs{Alle Dokumente<br/>gelabelt?}
                        CheckAllDocs -->|Nein| NextDocument[➡️ Nächstes Dokument verarbeiten]
                        CheckAllDocs -->|Ja| PaymentStatusCheck{Erste Zahlung<br/>erfolgt?}
                        
                        PaymentStatusCheck -->|Nein| WaitForPayment[⏳ Auf Zahlung warten<br/>Keine Berater-Prüfung ausgelöst]
                        PaymentStatusCheck -->|Ja| CheckReviewNeeded{Manuelle Prüfung<br/>Dokumente vorhanden?}
                        
                        CheckReviewNeeded -->|Ja| AgentMustReview[👨‍💼 Berater muss prüfen<br/>ALLE Manuelle Prüfung Dokumente]
                        CheckReviewNeeded -->|Nein| AllAIProcessed[Alle Dokumente<br/>KI Analysiert]
                        
                        AgentMustReview --> TriggerWebhook[🔔 Verarbeitungs-Webhook auslösen]
                        AllAIProcessed --> TriggerWebhook
                        
                        NextDocument --> Queue
                        
                        style OCR fill:#e3f2fd
                        style AIAnalysis fill:#fff3cd
                        style LabelAIAnalyzed fill:#d1e7dd
                        style LabelManualReview fill:#f8d7da
                        style NoTextEnd fill:#ffecb3
                        style ConfidenceCheck fill:#e8f5e8
                        style AgentMustReview fill:#fff2cc
                        style PaymentStatusCheck fill:#e1f5fe
                </div>
                
                <div class="legend">
                    <div class="legend-item">
                        <div class="legend-box" style="background: #e3f2fd;"></div>
                        <span>Google OCR</span>
                    </div>
                    <div class="legend-item">
                        <div class="legend-box" style="background: #fff3cd;"></div>
                        <span>KI-Verarbeitung</span>
                    </div>
                    <div class="legend-item">
                        <div class="legend-box" style="background: #d1e7dd;"></div>
                        <span>KI Analysiert (≥80%)</span>
                    </div>
                    <div class="legend-item">
                        <div class="legend-box" style="background: #f8d7da;"></div>
                        <span>Manuelle Prüfung (<80%)</span>
                    </div>
                    <div class="legend-item">
                        <div class="legend-box" style="background: #ffecb3;"></div>
                        <span>Kein Text - Verarbeitung beenden</span>
                    </div>
                    <div class="legend-item">
                        <div class="legend-box" style="background: #e1f5fe;"></div>
                        <span>Zahlungsprüfung</span>
                    </div>
                    <div class="legend-item">
                        <div class="legend-box" style="background: #fff2cc;"></div>
                        <span>Berater-Prüfung erforderlich</span>
                    </div>
                </div>
                
                <div style="margin-top: 20px; padding: 15px; background: #f0f8ff; border-radius: 8px; border-left: 4px solid #2196F3;">
                    <h4 style="margin: 0 0 10px 0; color: #1976D2;">📊 KI-Verarbeitung & Zahlungslogik:</h4>
                    <ul style="margin: 0; padding-left: 20px;">
                        <li><strong>Schritt 1 - KI-Verarbeitung:</strong> Dokumente erhalten Labels basierend auf Konfidenz</li>
                        <li><strong>≥ 80% Konfidenz:</strong> Label = 'KI Analysiert' (bereit für Verarbeitung)</li>
                        <li><strong>< 80% Konfidenz:</strong> Label = 'Manuelle Prüfung' (benötigt Berater-Prüfung)</li>
                        <li><strong>Kein Text erkannt:</strong> Label = 'Kein Text' → ENDE (keine weitere Verarbeitung)</li>
                        <li><strong>Schritt 2 - Zahlungsprüfung:</strong> Nur nach Zahlung wird Berater-Prüfung ausgelöst</li>
                        <li><strong>Berater-Prüfung:</strong> Prüft NUR 'Manuelle Prüfung' Dokumente (ignoriert 'Kein Text' Docs)</li>
                        <li><strong>Beispiel:</strong> 20 Docs = 18 KI analysiert + 1 manuelle Prüfung + 1 kein Text → Berater prüft nur 1 Doc</li>
                    </ul>
                </div>
                
                <div style="margin-top: 30px; padding: 20px; background: #f8f9fa; border-radius: 8px; border-left: 4px solid #28a745;">
                    <h4 style="margin: 0 0 15px 0; color: #155724;">📧 Erweiterte Gläubiger-Kontakt Workflow</h4>
                    
                    <div style="margin-bottom: 20px;">
                        <h5 style="color: #495057; margin: 10px 0;">1. 📤 Gläubiger kontaktieren Phase:</h5>
                        <ul style="margin: 0; padding-left: 20px; color: #6c757d;">
                            <li><strong>E-Mail Vorlage:</strong> "Schuldenverifikation für Bereinigungsverhandlung"</li>
                            <li><strong>Zweck:</strong> Aktuelle Schuldenhöhen für genaue Bereinigungsplanung anfragen</li>
                            <li><strong>Grund:</strong> Original-Dokumentenbeträge könnten veraltet sein, benötigen aktuelle Saldi für faire Verteilung</li>
                            <li><strong>Inhalt:</strong> Rechtlicher Hinweis mit Anfrage nach aktuellem Schuldensaldo, Zinsen und Gebühren innerhalb 30 Tagen</li>
                        </ul>
                    </div>
                    
                    <div style="margin-bottom: 20px;">
                        <h5 style="color: #495057; margin: 10px 0;">2. 📊 Antwort-Verfolgungssystem:</h5>
                        <ul style="margin: 0; padding-left: 20px; color: #6c757d;">
                            <li><strong>Verfolgte Daten:</strong> Antwortdatum, aktualisierter Betrag, E-Mail Inhalt, Kontaktstatus</li>
                            <li><strong>Status-Typen:</strong> "geantwortet", "keine_antwort", "email_fehlgeschlagen"</li>
                            <li><strong>30-Tage Timer:</strong> Automatische Analyse-Auslösung nach Ende der Antwortzeit</li>
                        </ul>
                    </div>
                    
                    <div style="margin-bottom: 20px;">
                        <h5 style="color: #495057; margin: 10px 0;">3. 🔍 30-Tage Analyse-Logik:</h5>
                        <div style="background: white; padding: 15px; border-radius: 6px; margin-top: 10px;">
                            <table style="width: 100%; border-collapse: collapse; font-size: 14px;">
                                <thead>
                                    <tr style="background: #e9ecef;">
                                        <th style="padding: 8px; border: 1px solid #dee2e6;">Szenario</th>
                                        <th style="padding: 8px; border: 1px solid #dee2e6;">Betrags-Logik</th>
                                        <th style="padding: 8px; border: 1px solid #dee2e6;">Beispiel</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <tr>
                                        <td style="padding: 8px; border: 1px solid #dee2e6;"><strong>Gläubiger antwortete</strong></td>
                                        <td style="padding: 8px; border: 1px solid #dee2e6;">Neuen Betrag aus Antwort verwenden</td>
                                        <td style="padding: 8px; border: 1px solid #dee2e6;">Original: €500 → Antwort: €650 → Verwenden: €650</td>
                                    </tr>
                                    <tr style="background: #f8f9fa;">
                                        <td style="padding: 8px; border: 1px solid #dee2e6;"><strong>Keine Antwort + Original vorhanden</strong></td>
                                        <td style="padding: 8px; border: 1px solid #dee2e6;">Original-Dokumentenbetrag verwenden</td>
                                        <td style="padding: 8px; border: 1px solid #dee2e6;">Original: €300 → Keine Antwort → Verwenden: €300</td>
                                    </tr>
                                    <tr>
                                        <td style="padding: 8px; border: 1px solid #dee2e6;"><strong>Keine Antwort + Kein Original</strong></td>
                                        <td style="padding: 8px; border: 1px solid #dee2e6;">Standard-Fallback Betrag</td>
                                        <td style="padding: 8px; border: 1px solid #dee2e6;">Original: N/A → Keine Antwort → Verwenden: €100</td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                    </div>
                    
                    <div>
                        <h5 style="color: #495057; margin: 10px 0;">4. 📈 Bereinigungsplan-Generierung:</h5>
                        <ul style="margin: 0; padding-left: 20px; color: #6c757d;">
                            <li><strong>Finale Tabelle:</strong> Alle Gläubiger mit finalisierten Beträgen mit 3-Stufen-Logik oben</li>
                            <li><strong>Prozentsatz-Berechnung:</strong> Anteil jedes Gläubigers basierend auf Gesamtschuldensumme</li>
                            <li><strong>Monatliche Quoten:</strong> Verteilung verfügbarer Mittel basierend auf Pfändungsberechnung</li>
                            <li><strong>Bereinigungsdokument:</strong> Rechtliches Dokument zur Genehmigung an Mandanten gesendet</li>
                        </ul>
                    </div>
                </div>
            </div>
        </div>

        <!-- Settlement Calculation Section -->
        <div id="settlement" class="section">
            <div class="flowchart-section">
                <h2>🧮 Bereinigungsplan-Berechnungsablauf</h2>
                <p class="description">
                    Detaillierte Ansicht wie der deutsche Pfändungsrechner Bereinigungspläne mit offiziellen 2025-2026 Pfändungstabellen erstellt.
                </p>
                <div class="mermaid">
                    graph TB
                        StartCalc([Bereinigungsberechnung]) --> InputFinancial[💰 Finanzdaten eingeben<br/>• Nettoeinkommen<br/>• Familienstand<br/>• Anzahl Kinder]
                        
                        InputFinancial --> GarnishmentLookup[📊 Deutsche Pfändungstabellen-Suche<br/>Offizielle 2025-2026 Pfändungstabelle<br/>334 Einkommensstufen]
                        
                        GarnishmentLookup --> DependentCalc{Unterhaltsberechtigte berechnen}
                        DependentCalc --> MarriedCheck{Verheiratet?}
                        MarriedCheck -->|Ja| AddSpouse[+1 Unterhaltsberechtigten<br/>für Ehepartner hinzufügen]
                        MarriedCheck -->|Nein| ChildrenCount[Nur Kinder zählen]
                        AddSpouse --> TotalDependents[Gesamt Unterhaltsberechtigte<br/>= Kinder + Ehepartner]
                        ChildrenCount --> TotalDependents
                        
                        TotalDependents --> TableLookup[🔍 Pfändbaren Betrag finden<br/>Basierend auf Einkommen + Unterhaltsberechtigte]
                        TableLookup --> GarnishableAmount[💶 Monatlich pfändbarer Betrag<br/>Beispiel: €209,49/Monat]
                        
                        GarnishableAmount --> GetCreditors[📋 Finale Gläubigerliste holen<br/>mit 3-Stufen-Beträgen]
                        GetCreditors --> CalculateTotal[➕ Gesamtschuld berechnen<br/>Alle Gläubigerbeträge summieren]
                        
                        CalculateTotal --> DistributionLoop[🔄 Für jeden Gläubiger:<br/>Anteiligen Anteil berechnen]
                        DistributionLoop --> PercentageCalc[📊 Schulden-Prozentsatz<br/>= Gläubiger-Betrag / Gesamtschuld]
                        PercentageCalc --> MonthlyQuota[💰 Monatliche Zahlung<br/>= Pfändbar × Prozentsatz]
                        MonthlyQuota --> Plan36Months[📅 36-Monats-Plan<br/>Gesamt = Monatlich × 36]
                        
                        Plan36Months --> NextCreditor{Weitere Gläubiger?}
                        NextCreditor -->|Ja| DistributionLoop
                        NextCreditor -->|Nein| FinalCalculation[✅ Bereinigungsplan vollständig]
                        
                        FinalCalculation --> DocGeneration[📄 Dokumente generieren]
                        DocGeneration --> SchuldenPlan[📋 Schuldenbereinigungsplan<br/>• Monatliche Zahlungsaufschlüsselung<br/>• 36-Monats-Zeitplan<br/>• Gläubiger-Quoten<br/>• Rechtliche Formatierung]
                        DocGeneration --> ForderungsUeber[📑 Forderungsübersicht<br/>• Vollständige Gläubigerliste<br/>• Kontaktinformationen<br/>• Betragsquellen<br/>• Antwortstatus]
                        
                        SchuldenPlan --> DocumentsReady[📤 Dokumente bereit<br/>zum Download]
                        ForderungsUeber --> DocumentsReady
                        
                        style GarnishmentLookup fill:#e3f2fd
                        style GarnishableAmount fill:#c8e6c9
                        style PercentageCalc fill:#fff3cd
                        style SchuldenPlan fill:#f3e5f5
                        style ForderungsUeber fill:#e8f5e9
                </div>
                
                <div style="margin-top: 30px; padding: 20px; background: #f8f9fa; border-radius: 8px; border-left: 4px solid #007bff;">
                    <h4 style="margin: 0 0 15px 0; color: #004085;">🧮 Bereinigungsberechnung Details</h4>
                    
                    <div style="margin-bottom: 20px;">
                        <h5 style="color: #495057; margin: 10px 0;">1. 📊 Deutsche Pfändungstabelle (2025-2026)</h5>
                        <ul style="margin: 0; padding-left: 20px; color: #6c757d;">
                            <li><strong>334 Einkommensstufen</strong>: Von €1.559,99 bis €4.766,99 Nettoeinkommen</li>
                            <li><strong>Unterhaltsberechtigte Stufen</strong>: 0-5+ Unterhaltsberechtigte (verheiratet = +1 Unterhaltsberechtigter)</li>
                            <li><strong>Offizielle Quelle</strong>: Deutsche gesetzliche Pfändungssätze (Pfändungstabelle)</li>
                            <li><strong>Beispiel</strong>: €3.000 netto, verheiratet, 1 Kind (2 Unterhaltsberechtigte) = €209,49 pfändbar</li>
                        </ul>
                    </div>
                    
                    <div style="margin-bottom: 20px;">
                        <h5 style="color: #495057; margin: 10px 0;">2. 🎯 Proportionale Verteilungsformel</h5>
                        <div style="background: #e9ecef; padding: 15px; border-radius: 6px; font-family: monospace;">
                            <strong>Für jeden Gläubiger:</strong><br/>
                            • Schulden-Prozentsatz = Gläubiger-Betrag ÷ Gesamtschuld<br/>
                            • Monatliche Zahlung = Pfändbares Einkommen × Schulden-Prozentsatz<br/>
                            • 36-Monats-Gesamt = Monatliche Zahlung × 36<br/><br/>
                            
                            <strong>Beispiel mit €25.000 Gesamtschuld:</strong><br/>
                            • Gläubiger A: €5.000 Schuld = 20% = €41,90/Monat = €1.508,40 gesamt<br/>
                            • Gläubiger B: €3.000 Schuld = 12% = €25,14/Monat = €905,04 gesamt<br/>
                            • Gläubiger C: €17.000 Schuld = 68% = €142,45/Monat = €5.128,20 gesamt
                        </div>
                    </div>
                    
                    <div style="margin-bottom: 20px;">
                        <h5 style="color: #495057; margin: 10px 0;">3. 📋 Die zwei generierten Dokumente</h5>
                        
                        <div style="display: flex; gap: 20px; margin-top: 10px;">
                            <div style="flex: 1; background: white; padding: 15px; border-radius: 6px; border: 1px solid #dee2e6;">
                                <h6 style="color: #6f42c1; margin: 0 0 10px 0;">📋 Schuldenbereinigungsplan</h6>
                                <ul style="margin: 0; padding-left: 15px; font-size: 13px;">
                                    <li>Monatliche Zahlungsaufschlüsselung pro Gläubiger</li>
                                    <li>36-Monats-Zahlungsplan</li>
                                    <li>Pfändbares Gesamteinkommen Berechnung</li>
                                    <li>Prozentuale Verteilungstabelle</li>
                                    <li>Rechtliche Formatierung für Gerichtseinreichung</li>
                                    <li>Mandanten- und Finanzdaten Zusammenfassung</li>
                                </ul>
                            </div>
                            
                            <div style="flex: 1; background: white; padding: 15px; border-radius: 6px; border: 1px solid #dee2e6;">
                                <h6 style="color: #28a745; margin: 0 0 10px 0;">📑 Forderungsübersicht</h6>
                                <ul style="margin: 0; padding-left: 15px; font-size: 13px;">
                                    <li>Vollständige Liste aller Gläubiger</li>
                                    <li>Kontaktinformationen und Adressen</li>
                                    <li>Schuldenbeträge mit Quellenverfolgung</li>
                                    <li>Antwortstatus (geantwortet/keine Antwort)</li>
                                    <li>Vertreter vs. direkte Gläubiger Info</li>
                                    <li>KI-Konfidenz Level und manuelle Prüfungen</li>
                                </ul>
                            </div>
                        </div>
                    </div>
                    
                    <div>
                        <h5 style="color: #495057; margin: 10px 0;">4. 🎯 Drei-Stufen-Betrags-Prioritätssystem</h5>
                        <div style="background: white; padding: 15px; border-radius: 6px;">
                            <table style="width: 100%; border-collapse: collapse; font-size: 14px;">
                                <thead>
                                    <tr style="background: #e9ecef;">
                                        <th style="padding: 8px; border: 1px solid #dee2e6;">Priorität</th>
                                        <th style="padding: 8px; border: 1px solid #dee2e6;">Betragsquelle</th>
                                        <th style="padding: 8px; border: 1px solid #dee2e6;">Zuverlässigkeit</th>
                                        <th style="padding: 8px; border: 1px solid #dee2e6;">Verwendung</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <tr>
                                        <td style="padding: 8px; border: 1px solid #dee2e6;"><strong>1.</strong></td>
                                        <td style="padding: 8px; border: 1px solid #dee2e6;">Gläubiger-Antwort</td>
                                        <td style="padding: 8px; border: 1px solid #dee2e6;"><span style="color: #28a745;">Höchste ✓</span></td>
                                        <td style="padding: 8px; border: 1px solid #dee2e6;">Aktuelle Schuld mit Zinsen/Gebühren</td>
                                    </tr>
                                    <tr style="background: #f8f9fa;">
                                        <td style="padding: 8px; border: 1px solid #dee2e6;"><strong>2.</strong></td>
                                        <td style="padding: 8px; border: 1px solid #dee2e6;">Original-Dokument (KI)</td>
                                        <td style="padding: 8px; border: 1px solid #dee2e6;"><span style="color: #ffc107;">Mittel ⚠</span></td>
                                        <td style="padding: 8px; border: 1px solid #dee2e6;">KI-extrahiert aus hochgeladenen Docs</td>
                                    </tr>
                                    <tr>
                                        <td style="padding: 8px; border: 1px solid #dee2e6;"><strong>3.</strong></td>
                                        <td style="padding: 8px; border: 1px solid #dee2e6;">Standard-Fallback</td>
                                        <td style="padding: 8px; border: 1px solid #dee2e6;"><span style="color: #dc3545;">Niedrigste ⚡</span></td>
                                        <td style="padding: 8px; border: 1px solid #dee2e6;">€100 Platzhalter-Schätzung</td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Status Workflow Section -->
        <div id="status" class="section">
            <div class="flowchart-section">
                <h2>🔄 Status-Workflow</h2>
                <p class="description">
                    Die vollständige Status-Progression zeigt wie Fälle durch das System
                    von der Erstellung bis zum Abschluss bewegt werden.
                </p>
                <div class="mermaid">
                    stateDiagram-v2
                        [*] --> Erstellt: Neuer Mandant
                        Erstellt --> PortalGesendet: Zugang senden
                        PortalGesendet --> DocsHochgeladen: Dokumente hochladen
                        DocsHochgeladen --> Verarbeitung: KI-Verarbeitung
                        Verarbeitung --> WartetZahlung: Vollständig
                        WartetZahlung --> Bestätigt: Zahlung eingegangen
                        Bestätigt --> Prüfung: 24h oder Override
                        Prüfung --> WartetMandant: Genehmigt
                        WartetMandant --> Aktiv: Mandant bestätigt
                        Aktiv --> Abgeschlossen: Alles erledigt
                        Abgeschlossen --> [*]
                        
                        Erstellt --> Abgebrochen: Keine Antwort
                        PortalGesendet --> Abgebrochen: Inaktiv
                        WartetZahlung --> Abgebrochen: Keine Zahlung
                        Abgebrochen --> [*]
                </div>
            </div>
        </div>

        <!-- Architecture Section -->
        <div id="architecture" class="section">
            <div class="flowchart-section">
                <h2>🏗️ System-Architektur</h2>
                <p class="description">
                    Übergeordnete Sicht auf die System-Komponenten und ihre Interaktionen.
                </p>
                <div class="mermaid">
                    graph TB
                        subgraph "Frontend"
                            Client[Mandanten-Portal]
                            Admin[Admin-Portal]
                            Agent[Berater-Portal]
                        end
                        
                        subgraph "Backend"
                            API[Express API]
                            Services[Service-Schicht]
                            Tasks[Geplante Aufgaben]
                        end
                        
                        subgraph "Daten"
                            Mongo[(MongoDB)]
                            Files[Datei-Speicher]
                        end
                        
                        subgraph "Extern"
                            Zendesk[Zendesk API]
                            AI[Claude/OpenAI]
                            Email[E-Mail Service]
                        end
                        
                        Client --> API
                        Admin --> API
                        Agent --> API
                        
                        API --> Services
                        API --> Tasks
                        
                        Services --> Mongo
                        Services --> Files
                        Tasks --> Mongo
                        
                        Services --> Zendesk
                        Services --> AI
                        Services --> Email
                        
                        style Client fill:#e3f2fd
                        style Admin fill:#fce4ec
                        style Agent fill:#e8f5e9
                </div>
            </div>
        </div>

        <!-- Admin Actions Section -->
        <div id="admin" class="section">
            <div class="flowchart-section">
                <h2>👨‍💼 Admin-Aktionen Ablauf</h2>
                <p class="description">
                    Administrative Funktionen einschließlich sofortiger Prüfung und Benutzerverwaltung.
                </p>
                <div class="mermaid">
                    graph LR
                        Admin([Admin Login]) --> Dash[Dashboard]
                        
                        Dash --> Actions{Aktion wählen}
                        
                        Actions -->|Analytik| Stats[Statistiken anzeigen]
                        Actions -->|Benutzer| List[Benutzerliste]
                        Actions -->|Einstellungen| Config[System-Konfiguration]
                        
                        List --> User[Benutzer wählen]
                        User --> Details[Details anzeigen]
                        User --> Immediate{Sofortige Prüfung?}
                        
                        Immediate -->|Prüfen| Valid{Gültiger Status?}
                        Valid -->|Ja| Trigger[🔥 Jetzt auslösen]
                        Valid -->|Nein| Error[Fehler anzeigen]
                        
                        Trigger --> Cancel[24h Verzögerung abbrechen]
                        Cancel --> Create[Zendesk-Ticket erstellen]
                        Create --> Update[Status aktualisieren]
                        Update --> Success[✅ Erfolgreich]
                        
                        style Trigger fill:#f8d7da
                        style Success fill:#d1e7dd
                </div>
            </div>
        </div>

        <!-- Document Calculations Section -->
        <div id="calculations" class="section">
            <div class="flowchart-section">
                <h2>📊 Dokumenten-Berechnungen Erklärt</h2>
                <p class="description">
                    Detaillierte mathematische Erklärungen wie die beiden generierten Dokumente (Schuldenbereinigungsplan und Forderungsübersicht)
                    Schritt-für-Schritt mit echten Beispielen berechnet werden.
                </p>

                <div style="margin-bottom: 40px; padding: 25px; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; border-radius: 12px;">
                    <h3 style="margin: 0 0 20px 0; text-align: center; font-size: 24px;">📋 Dokument 1: Schuldenbereinigungsplan</h3>
                    
                    <div style="background: rgba(255,255,255,0.1); padding: 20px; border-radius: 8px; margin-bottom: 20px;">
                        <h4 style="margin: 0 0 15px 0;">🎯 Zweck & Inhalt</h4>
                        <ul style="margin: 0; padding-left: 20px; line-height: 1.6;">
                            <li><strong>Rechtliches Dokument:</strong> Offizieller Bereinigungsplan für Gerichtseinreichung</li>
                            <li><strong>36-Monats-Plan:</strong> Vollständiger Zahlungsplan über 3 Jahre</li>
                            <li><strong>Monatliche Aufschlüsselung:</strong> Exakter Zahlungsbetrag pro Gläubiger jeden Monat</li>
                            <li><strong>Pfändungsgrundlage:</strong> Basierend auf offizieller deutscher Pfändungstabelle 2025-2026</li>
                            <li><strong>Proportionale Verteilung:</strong> Faire Zuteilung basierend auf Schuldenprozentsätzen</li>
                        </ul>
                    </div>

                    <div style="background: rgba(255,255,255,0.1); padding: 20px; border-radius: 8px;">
                        <h4 style="margin: 0 0 15px 0;">🧮 Schritt-für-Schritt Berechnungsprozess</h4>
                        
                        <div style="background: rgba(255,255,255,0.15); padding: 15px; border-radius: 6px; margin: 15px 0; font-family: monospace;">
                            <strong>SCHRITT 1: Pfändbares Einkommen bestimmen</strong><br/>
                            Eingabe: Nettoeinkommen = €3.000, Verheiratet + 1 Kind = 2 Unterhaltsberechtigte<br/>
                            Deutsche Tabellen-Suche → Pfändbarer Betrag = €209,49/Monat
                        </div>

                        <div style="background: rgba(255,255,255,0.15); padding: 15px; border-radius: 6px; margin: 15px 0; font-family: monospace;">
                            <strong>SCHRITT 2: Gesamtschuld berechnen (3-Stufen-System)</strong><br/>
                            Gläubiger A: €5.000 (Gläubiger-Antwort - höchste Priorität)<br/>
                            Gläubiger B: €3.000 (KI-extrahiert - mittlere Priorität)<br/>
                            Gläubiger C: €15.000 (Gläubiger-Antwort - höchste Priorität)<br/>
                            Gläubiger D: €100 (keine Daten - Standard-Fallback)<br/>
                            <strong>GESAMTSCHULD = €23.100</strong>
                        </div>

                        <div style="background: rgba(255,255,255,0.15); padding: 15px; border-radius: 6px; margin: 15px 0; font-family: monospace;">
                            <strong>SCHRITT 3: Prozentsätze & monatliche Zahlungen berechnen</strong><br/>
                            Gläubiger A: €5.000 ÷ €23.100 = 21,65% → €45,34/Monat<br/>
                            Gläubiger B: €3.000 ÷ €23.100 = 12,99% → €27,20/Monat<br/>
                            Gläubiger C: €15.000 ÷ €23.100 = 64,94% → €136,02/Monat<br/>
                            Gläubiger D: €100 ÷ €23.100 = 0,43% → €0,90/Monat<br/>
                            <strong>GESAMT MONATLICH = €209,49</strong> ✓
                        </div>

                        <div style="background: rgba(255,255,255,0.15); padding: 15px; border-radius: 6px; margin: 15px 0; font-family: monospace;">
                            <strong>SCHRITT 4: 36-Monats-Gesamtberechnungen</strong><br/>
                            Gläubiger A: €45,34 × 36 = €1.632,24<br/>
                            Gläubiger B: €27,20 × 36 = €979,20<br/>
                            Gläubiger C: €136,02 × 36 = €4.896,72<br/>
                            Gläubiger D: €0,90 × 36 = €32,40<br/>
                            <strong>GESAMT 36-MONATE = €7.540,56</strong>
                        </div>
                    </div>
                </div>

                <div style="margin-bottom: 40px; padding: 25px; background: linear-gradient(135deg, #11998e 0%, #38ef7d 100%); color: white; border-radius: 12px;">
                    <h3 style="margin: 0 0 20px 0; text-align: center; font-size: 24px;">📑 Dokument 2: Forderungsübersicht</h3>
                    
                    <div style="background: rgba(255,255,255,0.1); padding: 20px; border-radius: 8px; margin-bottom: 20px;">
                        <h4 style="margin: 0 0 15px 0;">🎯 Zweck & Inhalt</h4>
                        <ul style="margin: 0; padding-left: 20px; line-height: 1.6;">
                            <li><strong>Vollständige Datenbank:</strong> Komplette Liste aller identifizierten Gläubiger</li>
                            <li><strong>Kontaktinformationen:</strong> Namen, Adressen, E-Mail-Adressen, Telefonnummern</li>
                            <li><strong>Schuldenverfolgung:</strong> Originalbeträge vs. Endbeträge mit Quellenangabe</li>
                            <li><strong>Antwortstatus:</strong> Wer auf Verifizierungsanfragen geantwortet hat und wer nicht</li>
                            <li><strong>KI-Konfidenz:</strong> Maschinelles Lernen Konfidenz-Scores für Datengenauigkeit</li>
                            <li><strong>Vertreter-Info:</strong> Unterscheidet zwischen direkten Gläubigern und Inkasso-Unternehmen</li>
                        </ul>
                    </div>

                    <div style="background: rgba(255,255,255,0.1); padding: 20px; border-radius: 8px;">
                        <h4 style="margin: 0 0 15px 0;">📋 Detaillierte Datenfelder-Erklärung</h4>
                        
                        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px; margin-top: 15px;">
                            <div style="background: rgba(255,255,255,0.15); padding: 15px; border-radius: 6px;">
                                <h5 style="margin: 0 0 10px 0;">👤 Gläubiger-Identität</h5>
                                <ul style="margin: 0; padding-left: 15px; font-size: 14px;">
                                    <li><strong>Firmenname:</strong> KI-extrahiert aus Dokumenten</li>
                                    <li><strong>Adresse:</strong> Vollständige Postadresse</li>
                                    <li><strong>Kontaktperson:</strong> Falls in Dokumenten angegeben</li>
                                    <li><strong>Referenznummer:</strong> Fall-/Kontonummern</li>
                                </ul>
                            </div>

                            <div style="background: rgba(255,255,255,0.15); padding: 15px; border-radius: 6px;">
                                <h5 style="margin: 0 0 10px 0;">💰 Betrags-Berechnung</h5>
                                <ul style="margin: 0; padding-left: 15px; font-size: 14px;">
                                    <li><strong>Original-Betrag:</strong> KI-extrahiert aus hochgeladenen Docs</li>
                                    <li><strong>Aktualisierter Betrag:</strong> Aus 30-Tage Gläubiger-Antworten</li>
                                    <li><strong>Finaler Betrag:</strong> Bestimmt durch 3-Stufen-Prioritätssystem</li>
                                    <li><strong>Quellen-Zuordnung:</strong> Woher der finale Betrag stammt</li>
                                </ul>
                            </div>

                            <div style="background: rgba(255,255,255,0.15); padding: 15px; border-radius: 6px;">
                                <h5 style="margin: 0 0 10px 0;">📊 Datenqualitäts-Metriken</h5>
                                <ul style="margin: 0; padding-left: 15px; font-size: 14px;">
                                    <li><strong>KI-Konfidenz:</strong> 0-100% Genauigkeits-Score</li>
                                    <li><strong>Manuelle Prüfungs-Flag:</strong> Ob menschliche Verifizierung benötigt</li>
                                    <li><strong>Datenvollständigkeit:</strong> Wie viele Infos extrahiert wurden</li>
                                    <li><strong>Validierungsstatus:</strong> Automatisierte Checks bestanden</li>
                                </ul>
                            </div>

                            <div style="background: rgba(255,255,255,0.15); padding: 15px; border-radius: 6px;">
                                <h5 style="margin: 0 0 10px 0;">📞 Kontaktstatus-Verfolgung</h5>
                                <ul style="margin: 0; padding-left: 15px; font-size: 14px;">
                                    <li><strong>Kontakt-Datum:</strong> Wann Verifizierungs-E-Mail gesendet wurde</li>
                                    <li><strong>Antwort-Status:</strong> Geantwortet/Keine Antwort/E-Mail fehlgeschlagen</li>
                                    <li><strong>Antwort-Datum:</strong> Wann Gläubiger geantwortet hat</li>
                                    <li><strong>Aktualisierte Informationen:</strong> Neue Beträge oder Korrekturen</li>
                                </ul>
                            </div>
                        </div>
                    </div>
                </div>

                <div style="padding: 25px; background: #f8f9fa; border-radius: 12px; border-left: 6px solid #28a745;">
                    <h3 style="margin: 0 0 20px 0; color: #155724;">🔍 Echtes Beispiel: Vollständige Berechnungs-Durchführung</h3>
                    
                    <div style="background: white; padding: 20px; border-radius: 8px; margin-bottom: 20px;">
                        <h4 style="color: #495057; margin: 0 0 15px 0;">📝 Fallstudie: Max Mustermann</h4>
                        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px;">
                            <div>
                                <h5 style="color: #6c757d;">Finanzielle Situation:</h5>
                                <ul style="margin: 0; padding-left: 20px; color: #6c757d;">
                                    <li>Nettoeinkommen: €2.800/Monat</li>
                                    <li>Verheiratet: Ja</li>
                                    <li>Kinder: 2</li>
                                    <li>Gesamt Unterhaltsberechtigte: 3 (Ehefrau + 2 Kinder)</li>
                                    <li><strong>Pfändbarer Betrag: €169,42/Monat</strong></li>
                                </ul>
                            </div>
                            <div>
                                <h5 style="color: #6c757d;">Hochgeladene Dokumente:</h5>
                                <ul style="margin: 0; padding-left: 20px; color: #6c757d;">
                                    <li>15 Gläubiger-Dokumente</li>
                                    <li>12 erfolgreich verarbeitet (≥80% Konfidenz)</li>
                                    <li>2 benötigen manuelle Prüfung (<80%)</li>
                                    <li>1 kein Text erkannt (schlecht gescannt)</li>
                                </ul>
                            </div>
                        </div>
                    </div>

                    <div style="background: white; padding: 20px; border-radius: 8px;">
                        <h4 style="color: #495057; margin: 0 0 15px 0;">📊 Finale Gläubiger-Beträge (Nach 30-Tage Antworten)</h4>
                        <table style="width: 100%; border-collapse: collapse; font-size: 14px;">
                            <thead>
                                <tr style="background: #e9ecef;">
                                    <th style="padding: 10px; border: 1px solid #dee2e6;">Gläubiger</th>
                                    <th style="padding: 10px; border: 1px solid #dee2e6;">Original (KI)</th>
                                    <th style="padding: 10px; border: 1px solid #dee2e6;">Antwort</th>
                                    <th style="padding: 10px; border: 1px solid #dee2e6;">Finaler Betrag</th>
                                    <th style="padding: 10px; border: 1px solid #dee2e6;">Quelle</th>
                                    <th style="padding: 10px; border: 1px solid #dee2e6;">%</th>
                                    <th style="padding: 10px; border: 1px solid #dee2e6;">Monatlich</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td style="padding: 8px; border: 1px solid #dee2e6;">Telekom AG</td>
                                    <td style="padding: 8px; border: 1px solid #dee2e6;">€2.400</td>
                                    <td style="padding: 8px; border: 1px solid #dee2e6;">€2.750</td>
                                    <td style="padding: 8px; border: 1px solid #dee2e6;"><strong>€2.750</strong></td>
                                    <td style="padding: 8px; border: 1px solid #dee2e6;">Gläubiger-Antwort</td>
                                    <td style="padding: 8px; border: 1px solid #dee2e6;">19,3%</td>
                                    <td style="padding: 8px; border: 1px solid #dee2e6;">€32,70</td>
                                </tr>
                                <tr style="background: #f8f9fa;">
                                    <td style="padding: 8px; border: 1px solid #dee2e6;">Stadtwerke GmbH</td>
                                    <td style="padding: 8px; border: 1px solid #dee2e6;">€850</td>
                                    <td style="padding: 8px; border: 1px solid #dee2e6;">Keine Antwort</td>
                                    <td style="padding: 8px; border: 1px solid #dee2e6;"><strong>€850</strong></td>
                                    <td style="padding: 8px; border: 1px solid #dee2e6;">Original-Dokument</td>
                                    <td style="padding: 8px; border: 1px solid #dee2e6;">6,0%</td>
                                    <td style="padding: 8px; border: 1px solid #dee2e6;">€10,12</td>
                                </tr>
                                <tr>
                                    <td style="padding: 8px; border: 1px solid #dee2e6;">Bank Kredit</td>
                                    <td style="padding: 8px; border: 1px solid #dee2e6;">€8.500</td>
                                    <td style="padding: 8px; border: 1px solid #dee2e6;">€9.200</td>
                                    <td style="padding: 8px; border: 1px solid #dee2e6;"><strong>€9.200</strong></td>
                                    <td style="padding: 8px; border: 1px solid #dee2e6;">Gläubiger-Antwort</td>
                                    <td style="padding: 8px; border: 1px solid #dee2e6;">64,5%</td>
                                    <td style="padding: 8px; border: 1px solid #dee2e6;">€109,29</td>
                                </tr>
                                <tr style="background: #f8f9fa;">
                                    <td style="padding: 8px; border: 1px solid #dee2e6;">Versicherung AG</td>
                                    <td style="padding: 8px; border: 1px solid #dee2e6;">€1.200</td>
                                    <td style="padding: 8px; border: 1px solid #dee2e6;">Keine Antwort</td>
                                    <td style="padding: 8px; border: 1px solid #dee2e6;"><strong>€1.200</strong></td>
                                    <td style="padding: 8px; border: 1px solid #dee2e6;">Original-Dokument</td>
                                    <td style="padding: 8px; border: 1px solid #dee2e6;">8,4%</td>
                                    <td style="padding: 8px; border: 1px solid #dee2e6;">€14,28</td>
                                </tr>
                                <tr>
                                    <td style="padding: 8px; border: 1px solid #dee2e6;">Unbekannter Gläubiger</td>
                                    <td style="padding: 8px; border: 1px solid #dee2e6;">N/A</td>
                                    <td style="padding: 8px; border: 1px solid #dee2e6;">Keine Antwort</td>
                                    <td style="padding: 8px; border: 1px solid #dee2e6;"><strong>€100</strong></td>
                                    <td style="padding: 8px; border: 1px solid #dee2e6;">Standard-Fallback</td>
                                    <td style="padding: 8px; border: 1px solid #dee2e6;">0,7%</td>
                                    <td style="padding: 8px; border: 1px solid #dee2e6;">€1,18</td>
                                </tr>
                                <tr style="background: #e9ecef; font-weight: bold;">
                                    <td style="padding: 8px; border: 1px solid #dee2e6;">GESAMT</td>
                                    <td style="padding: 8px; border: 1px solid #dee2e6;">-</td>
                                    <td style="padding: 8px; border: 1px solid #dee2e6;">-</td>
                                    <td style="padding: 8px; border: 1px solid #dee2e6;">€14.100</td>
                                    <td style="padding: 8px; border: 1px solid #dee2e6;">-</td>
                                    <td style="padding: 8px; border: 1px solid #dee2e6;">100%</td>
                                    <td style="padding: 8px; border: 1px solid #dee2e6;">€169,42</td>
                                </tr>
                            </tbody>
                        </table>
                        
                        <div style="margin-top: 15px; padding: 15px; background: #d1ecf1; border-radius: 6px; border-left: 4px solid #bee5eb;">
                            <strong>📈 Ergebnis:</strong> Max zahlt €169,42/Monat für 36 Monate = €6.099,12 Gesamt-Bereinigungsbetrag.
                            Dies entspricht 43,3% der Gesamtschuld (€14.100), was typisch für deutsche Insolvenz-Bereinigungen ist.
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Financial Data & Plan Types Section -->
        <div id="financial" class="section">
            <div class="flowchart-section">
                <h2>💰 Finanzdaten-Erfassung & Plantyp-Auswahl</h2>
                <p class="description">
                    Detaillierter Workflow für die Erfassung von Finanzdaten im Mandanten-Portal, automatische Pfändungsberechnung,
                    und Agent-gesteuerte Plantyp-Auswahl mit Generierung von vier spezialisierten Dokumenten.
                </p>
                <div class="mermaid">
                    graph TB
                        CreditorTimeout([30-Tage Glaeubiger-Antwortzeit<br/>abgelaufen]) --> ProcessAllResponses[Alle Glaeubiger-Antworten verarbeiten]
                        
                        ProcessAllResponses --> ResponseBreakdown[Antwort-Auswertung<br/>12 Glaeubiger antworteten<br/>5 keine Antwort Original-Betrag<br/>3 unbekannt 100 Euro Standard]
                        
                        ResponseBreakdown --> FinalAmountTable[Finale Betrags-Tabelle erstellen<br/>3-Stufen-Prioritaetssystem<br/>Glaeubiger-Antwort hoechste<br/>Original-Dokument mittel<br/>100 Euro Fallback niedrigste]
                        
                        FinalAmountTable --> TriggerFinancialForm[Finanzdaten-Formular aktivieren<br/>Status: financial_data_required]
                        
                        TriggerFinancialForm --> ClientPortalForm[Mandanten-Portal Formular<br/>Monatliches Nettoeinkommen Euro<br/>Anzahl Kinder falls vorhanden<br/>Familienstand Dropdown]
                        
                        ClientPortalForm --> FormSubmission{Formular<br/>ausgefuellt?}
                        FormSubmission -->|Nein| ValidationErrors[Validierungsfehler anzeigen<br/>Einkommen erforderlich<br/>Familienstand auswaehlen]
                        ValidationErrors --> ClientPortalForm
                        
                        FormSubmission -->|Ja| SaveToDatabase[Daten speichern in<br/>Client.financial_data<br/>income_monthly<br/>number_of_children<br/>marital_status<br/>collected_at]
                        
                        SaveToDatabase --> PfaendungCalculation[Pfaendungstabelle 2024 Berechnung<br/>Eingabe: Nettoeinkommen + Familie<br/>Output: Monatlich pfaendbarer Betrag]
                        
                        PfaendungCalculation --> AutoRecommendation[Automatische Plantyp-Empfehlung]
                        AutoRecommendation --> CheckGarnishable{Pfaendbares<br/>Einkommen groesser 0?}
                        
                        CheckGarnishable -->|Ja| FinalPlanQuota[FINAL: Quotenplan<br/>Automatisch ausgewaehlt<br/>Monatliche Raten ueber 36 Monate<br/>Basierend auf pfaendbarem Einkommen]
                        CheckGarnishable -->|Nein| FinalPlanNull[FINAL: Nullplan<br/>Automatisch ausgewaehlt<br/>Keine Zahlungen moeglich<br/>Basierend auf fehlendem pfaendbarem Einkommen]
                        
                        FinalPlanQuota --> GenerateTwoDocuments[Zwei Dokumente generieren]
                        FinalPlanNull --> GenerateTwoDocuments
                        
                        GenerateTwoDocuments --> Doc1[1. Gewaehlter Bereinigungsplan<br/>Word-Dokument je nach Plan-Typ:<br/>Quotenplan ODER Nullplan]
                        
                        GenerateTwoDocuments --> Doc2[2. Glaeubigerliste<br/>Vollstaendige Glaeubigerliste<br/>Kontaktinformationen<br/>Finale Betraege und Status]
                        
                        Doc1 --> DocumentsReady[Alle Dokumente bereit<br/>Status: documents_generated]
                        Doc2 --> DocumentsReady
                        
                        DocumentsReady --> SecondEmailRound[ZWEITE E-MAIL-RUNDE<br/>an alle Glaeubiger<br/>via Zendesk Side Conversations<br/>Plan-Genehmigung anfordern]
                        
                        SecondEmailRound --> TrackApprovals[Plan-Genehmigungen verfolgen<br/>30-Tage-Timer fuer Antworten<br/>Zustimmung/Ablehnung/Keine Antwort]
                        
                        TrackApprovals --> FinalComplete([Bereinigungsverfahren<br/>vollstaendig abgeschlossen])
                        
                        style CreditorTimeout fill:#e1f5e1
                        style ClientPortalForm fill:#e3f2fd
                        style PfaendungCalculation fill:#fff3cd
                        style CreateZendeskTicket fill:#cfe2ff
                        style GenerateFourDocuments fill:#f3e5f5
                        style Doc1 fill:#d1e7dd
                        style Doc2 fill:#d1e7dd
                        style Doc3 fill:#d1e7dd
                        style Doc4 fill:#d1e7dd
                        style SecondEmailRound fill:#ffe4e1
                        style FinalComplete fill:#e1f5e1
                </div>
                
                <div style="margin-top: 30px; padding: 25px; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; border-radius: 12px;">
                    <h3 style="margin: 0 0 20px 0; text-align: center; font-size: 24px;">📋 Familienstand-Optionen & Pfändungslogik</h3>
                    
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin-bottom: 20px;">
                        <div style="background: rgba(255,255,255,0.1); padding: 20px; border-radius: 8px;">
                            <h4 style="margin: 0 0 15px 0;">👥 Familienstand-Dropdown</h4>
                            <ul style="margin: 0; padding-left: 20px; line-height: 1.8;">
                                <li><strong>Ledig</strong> - Keine zusätzlichen Unterhaltspflichtigen</li>
                                <li><strong>Verheiratet</strong> - +1 Unterhaltsberechtigter (Ehepartner)</li>
                                <li><strong>Geschieden</strong> - Ggf. Unterhaltszahlungen berücksichtigen</li>
                                <li><strong>Verwitwet</strong> - Ähnlich ledig, spezielle Regelungen</li>
                                <li><strong>Getrennt lebend</strong> - Komplexere Unterhaltssituation</li>
                            </ul>
                        </div>
                        
                        <div style="background: rgba(255,255,255,0.1); padding: 20px; border-radius: 8px;">
                            <h4 style="margin: 0 0 15px 0;">🧮 Pfändungsberechnung</h4>
                            <ul style="margin: 0; padding-left: 20px; line-height: 1.8;">
                                <li><strong>Basis:</strong> Deutsche Pfändungstabelle 2024</li>
                                <li><strong>Faktoren:</strong> Nettoeinkommen + Unterhaltspflichtige</li>
                                <li><strong>Verheiratet:</strong> Automatisch +1 Unterhaltsberechtigter</li>
                                <li><strong>Kinder:</strong> Jeweils +1 Unterhaltsberechtigter</li>
                                <li><strong>Ergebnis:</strong> Monatlich pfändbarer Betrag</li>
                            </ul>
                        </div>
                    </div>
                    
                    <div style="background: rgba(255,255,255,0.15); padding: 20px; border-radius: 8px;">
                        <h4 style="margin: 0 0 15px 0;">🎯 Plan-Typ Entscheidungsmatrix</h4>
                        <table style="width: 100%; border-collapse: collapse; background: rgba(255,255,255,0.9); color: #333; border-radius: 6px; overflow: hidden;">
                            <thead>
                                <tr style="background: #495057; color: white;">
                                    <th style="padding: 12px; text-align: left;">Bedingung</th>
                                    <th style="padding: 12px; text-align: left;">Empfohlener Plan-Typ</th>
                                    <th style="padding: 12px; text-align: left;">Beispiel</th>
                                    <th style="padding: 12px; text-align: left;">Begründung</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr style="background: #f8f9fa;">
                                    <td style="padding: 10px; border-bottom: 1px solid #dee2e6;"><strong>Pfändbares Einkommen > 0€</strong></td>
                                    <td style="padding: 10px; border-bottom: 1px solid #dee2e6; background: #d4edda;"><strong>Quotenplan</strong></td>
                                    <td style="padding: 10px; border-bottom: 1px solid #dee2e6;">Dall: 750€/Monat, Drewitz: 880,78€/Monat</td>
                                    <td style="padding: 10px; border-bottom: 1px solid #dee2e6;">Regelmäßige planbare Zahlungen</td>
                                </tr>
                                <tr>
                                    <td style="padding: 10px;"><strong>Kein pfändbares Einkommen</strong></td>
                                    <td style="padding: 10px; background: #fff3cd;"><strong>Nullplan</strong></td>
                                    <td style="padding: 10px;">Laux: Flexible Zahlungen</td>
                                    <td style="padding: 10px;">Zahlungen nur bei Einkommensverbesserung</td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
                
                <div style="margin-top: 30px; padding: 25px; background: linear-gradient(135deg, #11998e 0%, #38ef7d 100%); color: white; border-radius: 12px;">
                    <h3 style="margin: 0 0 20px 0; text-align: center; font-size: 24px;">📄 Die Zwei Generierten Dokumente</h3>
                    
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px;">
                        <div style="background: rgba(255,255,255,0.1); padding: 20px; border-radius: 8px;">
                            <h4 style="margin: 0 0 15px 0; color: #fff;">📋 1. Gewählter Bereinigungsplan</h4>
                            <ul style="margin: 0; padding-left: 20px; line-height: 1.6; font-size: 14px;">
                                <li><strong>Quotenplan</strong> - Monatliche Raten über 36 Monate</li>
                                <li><strong>Nullplan</strong> - Keine Zahlungen bei fehlendem pfändbaren Einkommen</li>
                                <li><strong>Rechtliche Formatierung</strong> für Gerichtseinreichung</li>
                                <li><strong>Agent-gewählter Plan-Typ</strong> basierend auf Finanzdaten</li>
                                <li><strong>Mandanten-Signatur-Bereich</strong> für Genehmigung</li>
                            </ul>
                        </div>
                        
                        <div style="background: rgba(255,255,255,0.1); padding: 20px; border-radius: 8px;">
                            <h4 style="margin: 0 0 15px 0; color: #fff;">📑 2. Gläubigerliste</h4>
                            <ul style="margin: 0; padding-left: 20px; line-height: 1.6; font-size: 14px;">
                                <li><strong>Komplette Gläubiger-Datenbank</strong> mit allen Details</li>
                                <li><strong>Kontaktinformationen</strong> (Adressen, E-Mails, Tel.)</li>
                                <li><strong>Betragshistorie</strong> (Original → Antwort → Final)</li>
                                <li><strong>Antwortstatus-Verfolgung</strong> (30-Tage-Ergebnis)</li>
                                <li><strong>KI-Konfidenz-Levels</strong> und Datenqualität</li>
                                <li><strong>Vertreter vs. Direkte</strong> Gläubiger-Klassifikation</li>
                            </ul>
                        </div>
                        
                    </div>
                </div>
                
                <div style="margin-top: 30px; padding: 20px; background: #f8f9fa; border-radius: 8px; border-left: 6px solid #007bff;">
                    <h4 style="margin: 0 0 15px 0; color: #004085;">🔄 Workflow-Integration: Wo sind die Daten?</h4>
                    <div style="display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 15px;">
                        <div style="background: white; padding: 15px; border-radius: 6px; border: 1px solid #dee2e6;">
                            <h5 style="color: #495057; margin: 0 0 10px 0;">📊 Client Model</h5>
                            <ul style="margin: 0; padding-left: 15px; font-size: 13px; color: #6c757d;">
                                <li><code>financial_data.income_monthly</code></li>
                                <li><code>financial_data.number_of_children</code></li>
                                <li><code>financial_data.marital_status</code></li>
                                <li><code>financial_data.garnishable_amount</code></li>
                                <li><code>financial_data.recommended_plan_type</code></li>
                            </ul>
                        </div>
                        
                        <div style="background: white; padding: 15px; border-radius: 6px; border: 1px solid #dee2e6;">
                            <h5 style="color: #495057; margin: 0 0 10px 0;">🎫 Zendesk Ticket</h5>
                            <ul style="margin: 0; padding-left: 15px; font-size: 13px; color: #6c757d;">
                                <li>Finanzdaten-Zusammenfassung</li>
                                <li>Berechneter pfändbarer Betrag</li>
                                <li>System-Empfehlung mit Begründung</li>
                                <li>Agent-Entscheidungsaufforderung</li>
                                <li>Link zum Review Dashboard</li>
                            </ul>
                        </div>
                        
                        <div style="background: white; padding: 15px; border-radius: 6px; border: 1px solid #dee2e6;">
                            <h5 style="color: #495057; margin: 0 0 10px 0;">📄 Word Dokumente</h5>
                            <ul style="margin: 0; padding-left: 15px; font-size: 13px; color: #6c757d;">
                                <li>Gewählter-Bereinigungsplan.docx</li>
                                <li>Gläubigerliste.docx</li>
                                <li>Beide als Download verfügbar</li>
                                <li>Via Zendesk Side Conversations an alle Gläubiger gesendet</li>
                            </ul>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        mermaid.initialize({ 
            startOnLoad: true,
            theme: 'default',
            themeVariables: {
                primaryColor: '#fff',
                primaryTextColor: '#333',
                primaryBorderColor: '#9f1a1d',
                lineColor: '#333',
                secondaryColor: '#f5f5f5',
                tertiaryColor: '#fff'
            }
        });

        function showSection(sectionId) {
            // Hide all sections
            document.querySelectorAll('.section').forEach(section => {
                section.classList.remove('active');
            });
            
            // Remove active class from all tabs
            document.querySelectorAll('.nav-tab').forEach(tab => {
                tab.classList.remove('active');
            });
            
            // Show selected section
            document.getElementById(sectionId).classList.add('active');
            
            // Mark the clicked tab as active
            event.target.classList.add('active');
            
            // Re-render Mermaid diagrams
            mermaid.init();
        }
    </script>
</body>
</html>